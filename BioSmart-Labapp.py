import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
import time

# ==============================================================================
# 1. PAGE CONFIG & THEME
# ==============================================================================
st.set_page_config(
    page_title="ูุฎุชุจุฑ ุงููุนูููุงุชูุฉ ุงูุตุญูุฉ ุงูุฐูู",
    page_icon="๐งฌ",
    layout="wide"
)

# ุชุตููู ุนุตุฑู ูุฌูุน ุจูู ุงูุทุงุจุน ุงูุทุจู ูุงูุชููู
st.markdown("""
<style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700&display=swap');
    * { font-family: 'Tajawal', sans-serif; }
    .main { background-color: #f0f4f8; }
    .stCard {
        background: white;
        padding: 25px;
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.05);
        margin-bottom: 20px;
    }
    .topic-header {
        color: #1a508b;
        border-right: 5px solid #1a508b;
        padding-right: 15px;
        margin-bottom: 20px;
    }
    .ai-bubble {
        background-color: #e3f2fd;
        padding: 15px;
        border-radius: 15px 15px 0 15px;
        border: 1px solid #bbdefb;
    }
</style>
""", unsafe_allow_html=True)

# ==============================================================================
# 2. DATA & CONTENT (KNOWLEDGE BASE)
# ==============================================================================
INFORMATICS_MODULES = {
    "ููุฏูุฉ ูู ุงููุนูููุงุชูุฉ": {
        "definition": "ูู ุงูุนูู ุงูุฐู ูุฌูุน ุจูู ุงูุทุจุ ุชูููููุฌูุง ุงููุนูููุงุชุ ูุนูู ุงูุจูุงูุงุช ูุชุญุณูู ุงูุฑุนุงูุฉ ุงูุตุญูุฉ.",
        "key_concepts": ["ุงูุจูุงูุงุช (Data)", "ุงููุนูููุงุช (Information)", "ุงููุนุฑูุฉ (Knowledge)", "ุงูุญููุฉ (Wisdom) - ูููุฐุฌ DIKW"],
        "ai_insight": "ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุง ููููู ุงููุตูู ููุฑุชุจุฉ 'ุงูุญููุฉ' ุฏูู ุจูุงูุงุช ุฏูููุฉ ูููุธูุฉ ูู ุงูุณุฌูุงุช ุงูุตุญูุฉ."
    },
    "ุงูุณุฌูุงุช ุงูุตุญูุฉ ุงูุฅููุชุฑูููุฉ (EHR)": {
        "definition": "ูุณุฎุฉ ุฑูููุฉ ูู ุงูููู ุงูุทุจู ูููุฑูุถุ ุชุดูู ุงูุชุงุฑูุฎ ุงููุฑุถูุ ุงูุฃุฏููุฉุ ูุงููุชุงุฆุฌ ุงููุฎุจุฑูุฉ.",
        "key_concepts": ["ุงูุชูุงูููุฉ (Interoperability)", "ูุนุงููุฑ HL7", "ุชุจุงุฏู ุงููุนูููุงุช ุงูุตุญูุฉ (HIE)"],
        "ai_insight": "ุงูู AI ูุญูู ุจูุงูุงุช ุงูู EHR ููุชูุจุค ุจุงูุฃูุฑุงุถ ูุจู ูููุนูุง (Predictive Analytics)."
    },
    "ุชุฑููุฒ ุงูุจูุงูุงุช ุงูุทุจูุฉ": {
        "definition": "ุชุญููู ุงูุชุดุฎูุตุงุช ูุงูุฅุฌุฑุงุกุงุช ุงูุทุจูุฉ ุฅูู ุฑููุฒ ุนุงูููุฉ ููุญุฏุฉ.",
        "key_concepts": ["ICD-10 (ุงูุชุดุฎูุตุงุช)", "CPT (ุงูุฅุฌุฑุงุกุงุช)", "SNOMED-CT (ุงููุตุทูุญุงุช ุงูุทุจูุฉ)"],
        "ai_insight": "ุฎูุงุฑุฒููุงุช ุงูู NLP ุชุณุงุนุฏ ูู ุงุณุชุฎุฑุงุฌ ูุฐู ุงูุฑููุฒ ุชููุงุฆูุงู ูู ููุงุญุธุงุช ุงูุฃุทุจุงุก."
    }
}

# ==============================================================================
# 3. SIDEBAR NAVIGATION
# ==============================================================================
with st.sidebar:
    st.image("https://cdn-icons-png.flaticon.com/512/3062/3062232.png", width=100)
    st.title("ุฃูุงุฏูููุฉ ุงููุนูููุงุชูุฉ")
    st.markdown("---")
    choice = st.radio("ุงุฎุชุฑ ุงููุญุฏุฉ ุงูุชุนููููุฉ:", list(INFORMATICS_MODULES.keys()))
    st.markdown("---")
    st.caption("ุฅุนุฏุงุฏ: ูุดูู ุงููุนูููุงุชูุฉ ุงูุตุญูุฉ ๐งโ๐ป")

# ==============================================================================
# 4. MAIN INTERFACE
# ==============================================================================

# Header Section
st.markdown(f"<h1 style='text-align: center; color: #1a508b;'>๐งฌ ููุตุฉ {choice}</h1>", unsafe_allow_html=True)
st.markdown("<p style='text-align: center;'>ุชุนูู ุฃุณุงุณูุงุช ุงูู Health Informatics ูุฏุนููุงู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู</p>", unsafe_allow_html=True)

col_info, col_ai = st.columns([2, 1])

with col_info:
    st.markdown(f"""
    <div class="stCard">
        <h3 class="topic-header">ูุงุฐุง ุณูุชุนููุ</h3>
        <p style='font-size: 1.2em;'>{INFORMATICS_MODULES[choice]['definition']}</p>
    </div>
    """, unsafe_allow_html=True)
    
    # ููุงููู ุฃุณุงุณูุฉ ุจุชุตููู ุชูุงุนูู
    st.subheader("๐ก ุงูููุงููู ุงูุฃุณุงุณูุฉ")
    cols = st.columns(len(INFORMATICS_MODULES[choice]['key_concepts']))
    for i, concept in enumerate(INFORMATICS_MODULES[choice]['key_concepts']):
        cols[i].info(concept)

    # ูุญุงูุงุฉ ุชูุงุนููุฉ (Interactive Informatics Demo)
    st.markdown("---")
    st.subheader("๐๏ธ ูุฎุชุจุฑ ุงููุญุงูุงุฉ")
    if choice == "ููุฏูุฉ ูู ุงููุนูููุงุชูุฉ":
        st.write("ุฑุชุจ ูุณุชููุงุช ูููุฐุฌ DIKW:")
        levels = ["ุงูุจูุงูุงุช", "ุงููุนูููุงุช", "ุงููุนุฑูุฉ", "ุงูุญููุฉ"]
        user_order = st.multiselect("ุฑุชุจ ูู ุงูุฃุณุงุณ ููููุฉ:", levels)
        if user_order == levels:
            st.success("ุชุฑุชูุจ ุตุญูุญ! ุฃูุช ุชูุดู ุนูู ุฎุทู ุงูุฎุจุฑุงุก.")
            
    elif choice == "ุงูุณุฌูุงุช ุงูุตุญูุฉ ุงูุฅููุชุฑูููุฉ (EHR)":
        st.write("ูุญุงูุงุฉ ุฑุจุท ุงูุจูุงูุงุช ุจูู ูุณุชุดูููู:")
        h1 = st.checkbox("ูุณุชุดูู ุงูุจุดูุฑ (ุจูุงูุงุช ูุฎุชุจุฑ)")
        h2 = st.checkbox("ูุณุชุดูู ุงูุฌุงูุนุฉ (ุจูุงูุงุช ุฃุดุนุฉ)")
        if h1 and h2:
            st.warning("๐ ุฌุงุฑู ุงูุชุฒุงูู ุนุจุฑ ูุนูุงุฑ HL7 FHIR...")
            time.sleep(1)
            st.success("ุชู ุชูููู ููู ูุฑูุถ ููุญุฏ! ูุฐุง ูู ุฌููุฑ ุงูู Interoperability.")

with col_ai:
    # ุฑูู ุงููุนูู ุงูุฐูู
    st.markdown(f"""
    <div class="stCard" style="background-color: #f8f9fa;">
        <h4 style="color: #0d47a1;">๐ค ุงููุนูู ุงูุฐูู (AI Tutor)</h4>
        <div class="ai-bubble">
            {INFORMATICS_MODULES[choice]['ai_insight']}
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # ุณุคุงู ุชูุงุนูู ูู ุงูู AI
    st.markdown("---")
    st.write("**ุงุฎุชุจุฑ ูููู:**")
    ans = st.radio("ูู ูููู ููู AI ุงูุนูู ุจุฏูู ูุนุงููุฑ ุชุฑููุฒ ููุญุฏุฉุ", ["ูุนูุ ูู ุฐูู ููุงูุฉ", "ูุงุ ุณูุญุฏุซ ุชุถุงุฑุจ ูู ุงูุจูุงูุงุช"])
    if st.button("ุชุฃููุฏ ุงูุฅุฌุงุจุฉ"):
        if ans == "ูุงุ ุณูุญุฏุซ ุชุถุงุฑุจ ูู ุงูุจูุงูุงุช":
            st.balloons()
            st.success("ุฅุฌุงุจุฉ ุนุจูุฑูุฉ! ุงูุชูุญูุฏ (Standardization) ูู ููุชุงุญ ุงููุฌุงุญ.")
        else:
            st.error("ููุณ ุชูุงูุงู.. ุงูู AI ูุญุชุงุฌ ูุบุฉ ููุญุฏุฉ ููููู ุงูุจูุงูุงุช.")

# ==============================================================================
# 5. DATA VISUALIZATION (THE INFORMATICS PART)
# ==============================================================================
st.markdown("---")
st.subheader("๐ ุชุญููู ุจูุงูุงุช ุตุญูุฉ (Informatics Visualizer)")
col_chart, col_desc = st.columns([2, 1])

# ุชูููุฏ ุจูุงูุงุช ููููุฉ ูููุญุงูุงุฉ
data = pd.DataFrame({
    'ุงูุณูุฉ': [2020, 2021, 2022, 2023, 2024, 2025],
    'ุชุจูู EHR (%)': [40, 55, 68, 80, 92, 98],
    'ุงูุฃุฎุทุงุก ุงูุทุจูุฉ (%)': [15, 12, 9, 6, 3, 1]
})

with col_chart:
    fig = px.line(data, x='ุงูุณูุฉ', y=['ุชุจูู EHR (%)', 'ุงูุฃุฎุทุงุก ุงูุทุจูุฉ (%)'], 
                  title="ุนูุงูุฉ ุงูุชุญูู ุงูุฑููู ุจุชูููู ุงูุฃุฎุทุงุก ุงูุทุจูุฉ",
                  markers=True, color_discrete_sequence=["#1a508b", "#CE1126"])
    st.plotly_chart(fig, use_container_width=True)

with col_desc:
    st.write("""
    **ุงูุชุญููู ุงููุนูููุงุชู:**
    ููุงุญุธ ูู ุงูุฑุณู ุงูุจูุงูู ุฃูู ูููุง ุฒุงุฏุช ูุณุจุฉ ุชุจูู ุงูุณุฌูุงุช ุงูุตุญูุฉ ุงูุฅููุชุฑูููุฉุ ุงูุฎูุถุช ูุณุจุฉ ุงูุฃุฎุทุงุก ุงูุทุจูุฉ ุจุดูู ููุญูุธ. 
    ูุฐุง ูุง ูุณููู **Clinical Decision Support (ูุธุงู ุฏุนู ุงููุฑุงุฑ ุงูุณุฑูุฑู)**.
    """)

# ==============================================================================
# 6. FOOTER
# ==============================================================================
st.markdown("---")
st.markdown("<p style='text-align: center; color: gray;'>ูุณุชูุจู ุงูุฑุนุงูุฉ ุงูุตุญูุฉ ูุจุฏุฃ ุจุจูุงูุงุช ููุธูุฉ ๐ป๐ฅ</p>", unsafe_allow_html=True)
